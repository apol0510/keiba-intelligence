---
import BaseLayout from '../../../../layouts/BaseLayout.astro';

export const prerender = false;

const { year, month, day } = Astro.params;

// æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
const date = `${year}-${month}-${day}`;
const dateFormatted = `${year}å¹´${parseInt(month)}æœˆ${parseInt(day)}æ—¥`;

// keiba-data-sharedã‹ã‚‰ãƒ‡ãƒ¼ã‚¿å–å¾—
let resultsData = null;
let predictionsData = null;
let errorMessage = null;

try {
  const url = `https://raw.githubusercontent.com/apol0510/keiba-data-shared/main/nankan/results/${year}/${month}/${date}.json`;
  const response = await fetch(url);

  if (!response.ok) {
    throw new Error('ãƒ‡ãƒ¼ã‚¿ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
  }

  resultsData = await response.json();
} catch (error) {
  errorMessage = error.message;
}

// äºˆæƒ³ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼ˆã‚ã‚Œã°ï¼‰
try {
  const predUrl = `https://raw.githubusercontent.com/apol0510/keiba-data-shared/main/nankan/predictions/${year}/${month}/${date}.json`;
  const predResponse = await fetch(predUrl);
  if (predResponse.ok) {
    predictionsData = await predResponse.json();
  }
} catch (error) {
  // äºˆæƒ³ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—
}

// å‡ºèµ°é ­æ•°ã‹ã‚‰è³¼å…¥ç‚¹æ•°ã‚’è¨ˆç®—
function calculatePoints(horses) {
  if (!horses) return 10; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
  if (horses <= 6) return 8;
  if (horses <= 9) return 9;
  if (horses <= 12) return 10;
  if (horses <= 14) return 11;
  if (horses <= 16) return 12;
  return 12;
}

// çš„ä¸­åˆ¤å®šé–¢æ•°ï¼ˆé¦¬å˜ã®ã¿ï¼‰
function checkHit(prediction, result) {
  if (!prediction || !result) return null;

  // é¦¬å˜çš„ä¸­åˆ¤å®šï¼ˆé…åˆ—ã«å«ã¾ã‚Œã‚‹ã‹ãƒã‚§ãƒƒã‚¯ï¼‰
  const umatanCombo = result.payouts?.umatan?.combination;
  let umatanMainHit = false;
  let umatanSubHit = false;

  if (umatanCombo && prediction.bettingLines?.umatan?.main) {
    umatanMainHit = prediction.bettingLines.umatan.main.includes(umatanCombo);
  }

  if (umatanCombo && prediction.bettingLines?.umatan?.sub && !umatanMainHit) {
    umatanSubHit = prediction.bettingLines.umatan.sub.includes(umatanCombo);
  }

  return {
    umatan: umatanMainHit ? 'main' : (umatanSubHit ? 'sub' : null)
  };
}

// å…¨ãƒ¬ãƒ¼ã‚¹é›†è¨ˆã‚’è¨ˆç®—
function calculateTotalStats(races, predictions) {
  if (!races || races.length === 0) return null;

  let totalPoints = 0;
  let hitRaces = 0;
  let totalPayout = 0;

  races.forEach(race => {
    const points = calculatePoints(race.horses);
    totalPoints += points;

    if (predictions) {
      const prediction = predictions.races?.find(p => p.raceNumber === race.raceNumber);
      const hitResult = checkHit(prediction, race);

      if (hitResult && hitResult.umatan) {
        hitRaces++;
        totalPayout += race.payouts?.umatan?.payout || 0;
      }
    }
  });

  const totalCost = totalPoints * 100;
  const hitRate = races.length > 0 ? Math.round((hitRaces / races.length) * 100) : 0;
  const recoveryRate = totalCost > 0 ? Math.round((totalPayout / totalCost) * 100) : 0;

  return {
    totalRaces: races.length,
    totalPoints,
    totalCost,
    hitRaces,
    hitRate,
    totalPayout,
    recoveryRate
  };
}

// ãƒšãƒ¼ã‚¸ç”¨ã®å…¨ãƒ¬ãƒ¼ã‚¹é›†è¨ˆã‚’è¨ˆç®—
const totalStats = resultsData ? calculateTotalStats(resultsData.races, predictionsData) : null;

// å„ãƒ¬ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ã‚’äº‹å‰ã«å‡¦ç†
const racesWithPredictions = resultsData?.races?.map(race => {
  const racePrediction = predictionsData?.races?.find(p => p.raceNumber === race.raceNumber);
  const hitResult = checkHit(racePrediction, race);
  return {
    ...race,
    prediction: racePrediction,
    hitResult
  };
}) || [];

// ç«¶é¦¬å ´ã‚³ãƒ¼ãƒ‰ã‚’æ—¥æœ¬èªåã«å¤‰æ›
const venueNames = {
  'OI': 'å¤§äº•',
  'KA': 'å·å´',
  'FU': 'èˆ¹æ©‹',
  'UR': 'æµ¦å’Œ'
};

const venueName = resultsData ? (resultsData.venue || venueNames[resultsData.venueCode] || 'ä¸æ˜') : 'ä¸æ˜';

// SEOç”¨
const pageTitle = resultsData
  ? `${dateFormatted} ${venueName}ç«¶é¦¬ å…¨${resultsData.races?.length || 0}Rçµæœãƒ»æ‰•æˆ»é‡‘`
  : `${dateFormatted} å—é–¢ç«¶é¦¬çµæœ`;

const pageDescription = resultsData && resultsData.races?.[0]
  ? `${venueName}ç«¶é¦¬ã®å…¨ãƒ¬ãƒ¼ã‚¹çµæœãƒ»æ‰•æˆ»é‡‘ã‚’å®Œå…¨å…¬é–‹ã€‚1ç€: ${resultsData.races[0].results?.[0]?.number}ç•ª ${resultsData.races[0].results?.[0]?.name}ã€å˜å‹${resultsData.races[0].payouts?.tansho?.payout || 0}å††...`
  : `${dateFormatted} å—é–¢ç«¶é¦¬ã®çµæœã‚’å…¬é–‹ä¸­`;
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <section class="result-detail-section">
    <div class="container">
      <div class="breadcrumb">
        <a href="/">ãƒ›ãƒ¼ãƒ </a>
        <span>â€º</span>
        <a href="/results">çµæœä¸€è¦§</a>
        <span>â€º</span>
        <span>{date}</span>
      </div>

      <h1 class="page-title">
        {dateFormatted} {venueName}ç«¶é¦¬
        {totalStats && totalStats.hitRaces > 0 && (
          <span class="hit-count-badge">{totalStats.hitRaces}/{totalStats.totalRaces}çš„ä¸­</span>
        )}
      </h1>

      {errorMessage && (
        <div class="error-message">
          <p>âŒ {errorMessage}</p>
          <a href="/results" class="btn btn-primary">çµæœä¸€è¦§ã«æˆ»ã‚‹</a>
        </div>
      )}

      {resultsData && (
        <>
          {/* å…¨ãƒ¬ãƒ¼ã‚¹é›†è¨ˆãƒãƒ¼ */}
          {totalStats && (
            <div class="total-stats-bar">
              <div class="stat-item">
                <span class="stat-icon">ğŸ¯</span>
                <span class="stat-label">çš„ä¸­ç‡:</span>
                <span class="stat-value">{totalStats.hitRate}%</span>
              </div>
              <div class="stat-item">
                <span class="stat-icon">ğŸ’°</span>
                <span class="stat-label">å›åç‡:</span>
                <span class={`stat-value ${totalStats.recoveryRate >= 100 ? 'positive' : 'negative'}`}>
                  {totalStats.recoveryRate}%
                </span>
              </div>
              <div class="stat-item">
                <span class="stat-icon">ğŸ“</span>
                <span class="stat-label">åˆè¨ˆè³¼å…¥ç‚¹æ•°:</span>
                <span class="stat-value">{totalStats.totalPoints}ç‚¹</span>
              </div>
              <div class="stat-item">
                <span class="stat-icon">ğŸ’µ</span>
                <span class="stat-label">åˆè¨ˆé…å½“:</span>
                <span class="stat-value">Â¥{totalStats.totalPayout.toLocaleString()}</span>
              </div>
            </div>
          )}

          <div class="cta-banner">
            <h2>ğŸ“Š æ˜æ—¥ã®äºˆæƒ³ã‚’è¦‹ã‚‹</h2>
            <p>AIåˆ†æã«ã‚ˆã‚‹é«˜ç²¾åº¦ãªè²·ã„ç›®ã‚’å…¬é–‹ä¸­</p>
            <div class="cta-buttons">
              <a href="/free-prediction" class="btn btn-secondary">ç„¡æ–™äºˆæƒ³</a>
              <a href="/prediction" class="btn btn-primary">æœ‰æ–™äºˆæƒ³</a>
            </div>
          </div>

          {racesWithPredictions.map((race) => (
            <div class="race-card">
              <div class="race-header">
                <div class="race-title-row">
                  <h2>ç¬¬{race.raceNumber}R</h2>
                  <span class="race-name">{race.raceName || ''}</span>
                  <div class="race-result-summary">
                    {race.hitResult && race.hitResult.umatan && (
                      <span class="hit-badge-mini">âœ… çš„ä¸­</span>
                    )}
                    {race.hitResult && race.hitResult.umatan && race.payouts?.umatan && (
                      <span class="payout-display">Â¥{race.payouts.umatan.payout.toLocaleString()}</span>
                    )}
                  </div>
                </div>
                <div class="race-info">
                  <span>{race.surface || 'ãƒ€ãƒ¼ãƒˆ'}{race.distance}m</span>
                  {race.track && <span>ï¼ˆ{race.track}ï¼‰</span>}
                  {race.horses && <span>{race.horses}é ­</span>}
                  {race.startTime && <span>ç™ºèµ°{race.startTime}</span>}
                </div>
              </div>

              {/* ãƒ¬ãƒ¼ã‚¹è§£èª¬ï¼ˆkeiba-data-sharedã‹ã‚‰å–å¾—ï¼‰ */}
              {race.commentary && (
                <div class="race-commentary">
                  <h3>ğŸ“ ãƒ¬ãƒ¼ã‚¹è§£èª¬</h3>
                  <p>{race.commentary}</p>
                </div>
              )}

              {/* ç€é †è¡¨ç¤º */}
              <div class="results-section">
                <h3>ğŸ ç€é †</h3>
                <div class="results-table">
                  <div class="table-header">
                    <span>ç€</span>
                    <span>æ </span>
                    <span>é¦¬ç•ª</span>
                    <span>é¦¬å</span>
                    <span>é¨æ‰‹</span>
                    <span>ã‚¿ã‚¤ãƒ </span>
                    <span>äººæ°—</span>
                  </div>
                  {race.results?.map((horse) => (
                    <div class={`table-row rank-${horse.rank}`}>
                      <span class="rank">{horse.rank}ç€</span>
                      <span>{horse.bracket}</span>
                      <span class="horse-number">{horse.number}</span>
                      <span class="horse-name">{horse.name}</span>
                      <span>{horse.jockey}</span>
                      <span>{horse.time}</span>
                      <span>{horse.popularity}äººæ°—</span>
                    </div>
                  ))}
                </div>
              </div>

              {/* æ‰•æˆ»é‡‘è¡¨ç¤º */}
              <div class="payouts-section">
                <h3>ğŸ’° æ‰•æˆ»é‡‘</h3>
                <div class="payouts-grid">
                  {race.payouts?.tansho && (
                    <div class="payout-card">
                      <div class="payout-type">å˜å‹</div>
                      <div class="payout-combo">{race.payouts.tansho.number}ç•ª</div>
                      <div class="payout-value">{race.payouts.tansho.payout.toLocaleString()}å††</div>
                      <div class="payout-popularity">{race.payouts.tansho.popularity}äººæ°—</div>
                    </div>
                  )}
                  {race.payouts?.umaren && (
                    <div class="payout-card">
                      <div class="payout-type">é¦¬è¤‡</div>
                      <div class="payout-combo">{race.payouts.umaren.combination}</div>
                      <div class="payout-value">{race.payouts.umaren.payout.toLocaleString()}å††</div>
                      <div class="payout-popularity">{race.payouts.umaren.popularity}äººæ°—</div>
                    </div>
                  )}
                  {race.payouts?.umatan && (
                    <div class="payout-card">
                      <div class="payout-type">é¦¬å˜</div>
                      <div class="payout-combo">{race.payouts.umatan.combination}</div>
                      <div class="payout-value">{race.payouts.umatan.payout.toLocaleString()}å††</div>
                      <div class="payout-popularity">{race.payouts.umatan.popularity}äººæ°—</div>
                    </div>
                  )}
                  {race.payouts?.wide && race.payouts.wide.length > 0 && (
                    <div class="payout-card">
                      <div class="payout-type">ãƒ¯ã‚¤ãƒ‰</div>
                      <div class="payout-combo">{race.payouts.wide[0].combination}</div>
                      <div class="payout-value">{race.payouts.wide[0].payout.toLocaleString()}å††</div>
                      <div class="payout-popularity">{race.payouts.wide[0].popularity}äººæ°—</div>
                    </div>
                  )}
                  {race.payouts?.sanrenpuku && (
                    <div class="payout-card">
                      <div class="payout-type">ä¸‰é€£è¤‡</div>
                      <div class="payout-combo">{race.payouts.sanrenpuku.combination}</div>
                      <div class="payout-value">{race.payouts.sanrenpuku.payout.toLocaleString()}å††</div>
                      <div class="payout-popularity">{race.payouts.sanrenpuku.popularity}äººæ°—</div>
                    </div>
                  )}
                  {race.payouts?.sanrentan && (
                    <div class="payout-card">
                      <div class="payout-type">ä¸‰é€£å˜</div>
                      <div class="payout-combo">{race.payouts.sanrentan.combination}</div>
                      <div class="payout-value">{race.payouts.sanrentan.payout.toLocaleString()}å††</div>
                      <div class="payout-popularity">{race.payouts.sanrentan.popularity}äººæ°—</div>
                    </div>
                  )}
                </div>
              </div>
            </div>
          ))}

          <div class="cta-section">
            <h2>ğŸ¯ AIäºˆæƒ³ã§çš„ä¸­ç‡ã‚¢ãƒƒãƒ—</h2>
            <p>éå»ãƒ‡ãƒ¼ã‚¿ã‚’AIåˆ†æã—ã€é«˜ç²¾åº¦ãªè²·ã„ç›®ã‚’æä¾›</p>
            <div class="cta-buttons-large">
              <a href="/pricing" class="btn btn-primary btn-lg">æ–™é‡‘ãƒ—ãƒ©ãƒ³ã‚’è¦‹ã‚‹</a>
              <a href="/free-prediction" class="btn btn-secondary btn-lg">ç„¡æ–™äºˆæƒ³ã‚’è©¦ã™</a>
            </div>
          </div>
        </>
      )}
    </div>
  </section>

  <style>
    .result-detail-section {
      padding: var(--spacing-2xl) 0;
      min-height: 100vh;
    }

    .breadcrumb {
      display: flex;
      gap: var(--spacing-sm);
      margin-bottom: var(--spacing-xl);
      color: var(--text-secondary);
      font-size: 0.875rem;
    }

    .breadcrumb a {
      color: var(--primary-end);
      text-decoration: none;
    }

    .breadcrumb a:hover {
      text-decoration: underline;
    }

    .page-title {
      font-size: 2.5rem;
      margin-bottom: var(--spacing-lg);
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      flex-wrap: wrap;
    }

    .hit-count-badge {
      display: inline-block;
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: var(--spacing-xs) var(--spacing-lg);
      border-radius: var(--radius-full);
      font-size: 1.125rem;
      font-weight: 700;
      box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
    }

    .total-stats-bar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--spacing-lg);
      background: linear-gradient(135deg, rgba(30, 41, 59, 0.8), rgba(15, 23, 42, 0.8));
      border: 2px solid rgba(59, 130, 246, 0.3);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-2xl);
      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.3);
    }

    .stat-item {
      display: flex;
      align-items: center;
      gap: var(--spacing-sm);
    }

    .stat-icon {
      font-size: 1.5rem;
    }

    .stat-label {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-end);
      margin-left: auto;
    }

    .stat-value.positive {
      color: #10b981;
    }

    .stat-value.negative {
      color: #ef4444;
    }

    .error-message {
      text-align: center;
      padding: var(--spacing-3xl);
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
    }

    .error-message p {
      font-size: 1.25rem;
      margin-bottom: var(--spacing-xl);
      color: var(--error);
    }

    .cta-banner {
      background: linear-gradient(135deg, var(--primary-start), var(--primary-end));
      padding: var(--spacing-xl);
      border-radius: var(--radius-lg);
      text-align: center;
      margin-bottom: var(--spacing-2xl);
      color: white;
    }

    .cta-banner h2 {
      margin-bottom: var(--spacing-sm);
      font-size: 1.75rem;
    }

    .cta-banner p {
      margin-bottom: var(--spacing-lg);
      opacity: 0.9;
    }

    .cta-buttons {
      display: flex;
      gap: var(--spacing-md);
      justify-content: center;
      flex-wrap: wrap;
    }

    .race-card {
      background: var(--bg-secondary);
      border-radius: var(--radius-lg);
      padding: var(--spacing-xl);
      margin-bottom: var(--spacing-xl);
    }

    .race-header {
      margin-bottom: var(--spacing-xl);
      padding-bottom: var(--spacing-lg);
      border-bottom: 2px solid var(--border-color);
    }

    .race-title-row {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-bottom: var(--spacing-sm);
      flex-wrap: wrap;
    }

    .race-header h2 {
      font-size: 2rem;
      font-weight: 700;
      color: #fbbf24;
      margin: 0;
    }

    .race-name {
      font-size: 1.125rem;
      color: var(--text-primary);
    }

    .race-result-summary {
      display: flex;
      align-items: center;
      gap: var(--spacing-md);
      margin-left: auto;
      flex-wrap: wrap;
    }

    .hit-badge-mini {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      padding: var(--spacing-xs) var(--spacing-md);
      border-radius: var(--radius-full);
      font-size: 0.875rem;
      font-weight: 600;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }

    .payout-display {
      background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(217, 119, 6, 0.2));
      color: #fbbf24;
      padding: var(--spacing-xs) var(--spacing-md);
      border-radius: var(--radius-md);
      font-size: 1.125rem;
      font-weight: 700;
      border: 1px solid rgba(245, 158, 11, 0.3);
    }

    .race-info {
      display: flex;
      gap: var(--spacing-md);
      flex-wrap: wrap;
      color: var(--text-secondary);
    }

    .hit-detection {
      background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(59, 130, 246, 0.1));
      border: 2px solid var(--success);
      border-radius: var(--radius-md);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
    }

    .hit-detection h3 {
      font-size: 1.25rem;
      margin-bottom: var(--spacing-md);
      color: var(--success);
    }

    .hit-badges {
      display: flex;
      gap: var(--spacing-sm);
      flex-wrap: wrap;
    }

    .badge {
      display: inline-block;
      padding: var(--spacing-xs) var(--spacing-md);
      border-radius: var(--radius-full);
      font-weight: 600;
      font-size: 0.875rem;
      transition: transform 0.2s;
    }

    .badge:hover {
      transform: scale(1.05);
    }

    .badge.hit {
      background: linear-gradient(135deg, #10b981, #059669);
      color: white;
      box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }

    .badge.hit-main {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
      animation: pulse 2s infinite;
    }

    .badge.hit-sub {
      background: linear-gradient(135deg, #3b82f6, #2563eb);
      color: white;
      box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.8;
      }
    }

    .race-commentary {
      background: var(--bg-tertiary);
      border-left: 4px solid var(--primary-end);
      padding: var(--spacing-lg);
      margin-bottom: var(--spacing-xl);
      border-radius: var(--radius-md);
    }

    .race-commentary h3 {
      font-size: 1.125rem;
      margin-bottom: var(--spacing-sm);
      color: var(--primary-end);
    }

    .race-commentary p {
      line-height: 1.8;
      color: var(--text-primary);
      font-size: 1rem;
    }

    .results-section,
    .payouts-section {
      margin-bottom: var(--spacing-xl);
    }

    .results-section h3,
    .payouts-section h3 {
      font-size: 1.25rem;
      margin-bottom: var(--spacing-md);
    }

    .results-table {
      display: flex;
      flex-direction: column;
      gap: var(--spacing-xs);
    }

    .table-header,
    .table-row {
      display: grid;
      grid-template-columns: 50px 40px 60px 1fr 120px 100px 60px;
      gap: var(--spacing-sm);
      padding: var(--spacing-sm);
      align-items: center;
    }

    .table-header {
      font-weight: 700;
      background: var(--bg-tertiary);
      border-radius: var(--radius-md);
      font-size: 0.875rem;
    }

    .table-row {
      background: var(--bg-primary);
      border-radius: var(--radius-md);
      transition: background 0.2s;
    }

    .table-row:hover {
      background: var(--bg-tertiary);
    }

    .table-row.rank-1 {
      border-left: 4px solid #fbbf24;
    }

    .table-row.rank-2 {
      border-left: 4px solid #9ca3af;
    }

    .table-row.rank-3 {
      border-left: 4px solid #cd7f32;
    }

    .rank {
      font-weight: 700;
    }

    .horse-number {
      font-weight: 700;
      color: var(--primary-end);
    }

    .horse-name {
      font-weight: 600;
    }

    .payouts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: var(--spacing-md);
    }

    .payout-card {
      background: var(--bg-tertiary);
      padding: var(--spacing-md);
      border-radius: var(--radius-md);
      text-align: center;
    }

    .payout-type {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: var(--spacing-xs);
    }

    .payout-combo {
      font-size: 1.125rem;
      font-weight: 600;
      font-family: 'Courier New', monospace;
      margin-bottom: var(--spacing-xs);
    }

    .payout-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--success);
      margin-bottom: var(--spacing-xs);
    }

    .payout-popularity {
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .cta-section {
      background: var(--bg-secondary);
      padding: var(--spacing-2xl);
      border-radius: var(--radius-lg);
      text-align: center;
      margin-top: var(--spacing-3xl);
    }

    .cta-section h2 {
      margin-bottom: var(--spacing-sm);
      font-size: 1.75rem;
    }

    .cta-section p {
      color: var(--text-secondary);
      margin-bottom: var(--spacing-xl);
      font-size: 1.125rem;
    }

    .cta-buttons-large {
      display: flex;
      gap: var(--spacing-lg);
      justify-content: center;
      flex-wrap: wrap;
    }

    @media (max-width: 1024px) {
      .table-header,
      .table-row {
        grid-template-columns: 45px 35px 50px 1fr 100px 90px 55px;
        font-size: 0.875rem;
      }
    }

    @media (max-width: 768px) {
      .page-title {
        font-size: 1.75rem;
        flex-direction: column;
        align-items: flex-start;
      }

      .hit-count-badge {
        font-size: 1rem;
      }

      .total-stats-bar {
        grid-template-columns: 1fr;
        gap: var(--spacing-md);
        padding: var(--spacing-md);
      }

      .stat-item {
        flex-wrap: wrap;
      }

      .stat-value {
        margin-left: 0;
        width: 100%;
        text-align: right;
      }

      .race-title-row {
        flex-direction: column;
        align-items: flex-start;
      }

      .race-header h2 {
        font-size: 1.5rem;
      }

      .race-result-summary {
        margin-left: 0;
        width: 100%;
        justify-content: flex-start;
      }

      .table-header,
      .table-row {
        grid-template-columns: 40px 30px 45px 1fr 80px 75px 50px;
        font-size: 0.75rem;
        padding: var(--spacing-xs);
        gap: var(--spacing-xs);
      }

      .payouts-grid {
        grid-template-columns: 1fr;
      }

      .cta-buttons-large {
        flex-direction: column;
      }

      .cta-buttons-large .btn {
        width: 100%;
      }
    }
  </style>
</BaseLayout>
